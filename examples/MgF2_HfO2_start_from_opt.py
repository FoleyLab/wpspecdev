import wptherml
from matplotlib import pyplot as plt
import numpy as np


d_start_1 = np.array([0.0,
 92.7323412,    9.55962937,  17.02193374,  16.08935889,  15.44916759,
 137.43357318,  15.47991339,  24.38128034,  38.74434517,   9.54995988,
 588.69320641,  10.46226187,  33.06847348,  24.8334307,   12.742923, 
 346.35214035,  15.40184835,  24.90028131,  37.02939053,   9.91520258,
 453.53513825,   9.34699006,  38.60246237,  23.77574401,  17.00899511,
 332.3609942,   15.65280798,  25.69089368,  38.42730944,  10.60190855,
 542.99362071,  10.61775051,  38.76782655,  25.36269063,  15.418318,
 380.71349209,  15.15168277,  25.87562255,  38.24033636,  10.98143762,
 523.50263155,  10.56246065,  40.67015481,  25.59852547,  16.28181738,
 368.34573809,  14.56486997,  26.16253567,  38.4975419,   10.62190858,
 528.71806818,   9.74289675,  39.02753226,  24.17072396,  15.43943966,
 330.58372533,  14.7235226,   27.92713852,  38.18843285,  11.51081945,
 439.77968112,  11.430953,    40.79199568,  27.79751689,  16.82743109,
 342.75558414,  18.73324815,  25.47896005,  41.93244253,   9.68226992,
 671.61432608,  16.35352182,  26.60320247, 107.61386095,  87.82928827,
0.0]) * 1e-9 * 0.92

#np.array([0.0, 
#96.80528767,  10.78192725,  14.83697325,  17.0282935,   17.03143573,
# 139.55235498,  14.05928488,  30.98423967,  38.7722332,   11.90653046,
# 596.23269015,  11.27419537,  35.62002884,  28.32134473,  12.67390609,
# 353.27499162,  17.55877695,  23.62525103,  40.69896521,   8.62494514,
# 455.52057328,   9.13956394,  40.97887428,  23.41869388,  17.86446113,
# 324.27690537,  15.15624481,  28.24383615,  36.40565361,  12.59753737,
# 618.60750228,  11.67214283,  35.11737269,  26.79566756,  13.28707145,
# 391.36322925,  16.8761998,   24.59166777,  40.1970733,   10.53479718,
# 518.715477,    11.42107441,  37.83563407,  26.45271092,  15.82189516,
# 333.34687626,  16.12890762,  25.3886711,   39.81800336,   9.88528081,
# 534.58819824,  11.44779267,  33.82304833,  25.46306254,  11.49452175,
# 317.26092032,  14.12040842,  28.1768175,   37.31098445,  11.94322884,
# 427.77347109,  10.14282629,  41.92441418,  26.82877763,  17.67733898,
# 341.94387959,  18.42654575,  26.70753697,  43.84808232,  10.07267779,
# 684.74363342,  16.65004803,  28.6272468,  111.00612032,  88.86055897,
#0.0]) * 1e-9
#np.array([0.00000000e+00,
#7.8961E-08, 2.837E-08, 4.12007E-08, 4.048E-08, 1.43864E-08, 5.5398E-07, 1.57308E-08, 3.959E-08, 4.39954E-08, 1.439E-08, 1.0551E-06,
#1.418E-08, 4.43554E-08, 3.953E-08, 1.59425E-08, 5.6418E-07, 1.391E-08, 4.29E-08, 4.17724E-08, 1.647E-08, 9.04325E-07, 1.627E-08, 4.19206E-08, 4.259E-08,
#1.41323E-08, 7.8043E-07, 1.59214E-08, 3.959E-08, 4.45883E-08, 1.416E-08, 8.00748E-07, 1.369E-08, 4.52023E-08, 3.914E-08, 1.63025E-08, 7.7129E-07,
#1.51062E-08, 4.048E-08, 4.35297E-08, 1.455E-08, 7.97637E-07, 1.351E-08, 4.46412E-08, 3.893E-08, 1.56038E-08, 5.525E-07, 1.57308E-08, 3.846E-08,
# 4.44824E-08, 1.332E-08, 1.03724E-06, 1.441E-08, 4.23123E-08, 3.886E-08, 1.49898E-08, 7.5536E-07, 1.42911E-08, 4.067E-08, 4.20159E-08, 1.535E-08, 7.88429E-07,
# 1.24E-08, 4.68325E-08, 3.734E-08, 1.73187E-08, 5.5042E-07, 1.46404E-08, 3.988E-08, 4.38049E-08, 1.372E-08, 1.04676E-06, 1.789E-08, 3.31977E-08, 1.5508E-07, 8.4561E-08,
#0.00000000e+00]) * 0.55

mat_start = []
ctr = 0
for d in d_start_1:
    if ctr==0:
        mat_start.append("Air")
    elif ctr % 2 == 1:
        mat_start.append("MgF2")
    else:
        mat_start.append("HfO2_udm")

    ctr += 1

mat_start[ctr-1] = 'Air'
        

print(len(mat_start))  


start_args = {
    "wavelength_list": [200e-9, 7000e-9, 2000],
    "Material_List": mat_start,
    "Thickness_List": d_start_1,
    "reflective_window_wn" : [2600, 3750],
    "transmissive_window_nm" : [300, 700],
    "transmission_efficiency_weight" : 0.2,
    "reflection_efficiency_weight" : 0.6,
    "reflection_selectivity_weight" : 0.2
}

sf = wptherml.SpectrumFactory() 
test = sf.spectrum_factory('Tmm', start_args)
ts = sf.spectrum_factory("Opt", start_args)
results = ts.optimize_basin_hopping()

print(results)
print(results.x)
for i in range(len(results.x)):
    print(F'{results.x[i] * 1e-9},')


